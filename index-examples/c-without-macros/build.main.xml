<?xml version="1.0" encoding="UTF-8" ?>

<project name="C-without-macros" default="all">
        
        <!-- Key input modules -->
        <property name="sdfmodule" value="C-without-macros"/>
        <property name="metasdfmodule" value="Stratego-C-without-macros"/>
        <property name="esvmodule" value="C-without-macros"/>
        <property name="strmodule" value="c_without_macros"/>
    
        <!-- Project directories -->
        <property name="trans" location="trans"/>
        <property name="src-gen" location="editor/java"/>
        <property name="syntax" location="syntax"/>
        <property name="include" location="include"/>
        <property name="lib" location="lib"/>
        <property name="build" location="bin"/>
        <property name="dist" location="bin/dist"/>
        
        <!-- Imports -->
        <property name="build.sdf.imports" value=""/>
        <property name="build.stratego.args" value="
                        --library
                        -I &quot;${trans}&quot;
                        -I &quot;${basedir}&quot;
                        -la stratego-lib -la stratego-parallel -la stratego-sglr -la stratego-gpp -la stratego-xtc -la stratego-aterm"/>
        
        <!-- Optional: external .def and .jar locations
        <property name="externaldef" location="syntax/${sdfmodule}.def"/>
        <property name="externaljar" value="../lib.jar"/>
        <property name="externaljarflags" value="-la org.lib"/>
        -->
    
        <!-- Environment configuration for command-line builds -->
        <condition property="build.strategoxt.sdf" value="${eclipse.spoofaximp.nativeprefix}" else="">
            <isset property="eclipse.spoofaximp.nativeprefix"/>
        </condition>
        <property name="build.strategoxt.stratego" location="${user.home}/.nix-profile/bin"/>
    
        <import file="build.generated.xml"/>
    
        <!-- Main target -->
        <target name="all" depends="link-lib-files, copy-lib-files, spoofaximp.default.jar"/>
      
        <target name="os-detection">
          <condition property="isWin">
            <os family="windows"/>
          </condition>  
        </target>
        
			  <target name="copy-lib-files" if="isWin" depends="os-detection">
			    <!-- Copy libraries from naming experiment, Ant is stupid and cannot link on Windows :( -->
			    <copy file="../index-libraries/lib/index-library.str" tofile="lib/index-library.str"/>
			    <copy file="../index-libraries/lib/analysis-library.str" tofile="lib/analysis-library.str"/>
			  	<copy file="../index-libraries/lib/analysis-library-internal.str" tofile="lib/analysis-library-internal.str"/>
			    <copy file="../index-libraries/lib/compilation-library.str" tofile="lib/compilation-library.str"/>
			  	<copy file="../index-libraries/lib/nbl-library.str" tofile="lib/nbl-library.str"/>
			  </target>
			  
			  <target name="link-lib-files" unless="isWin" depends="os-detection">
			    <!-- Link libraries from naming experiment -->
			    <symlink resource="${basedir}/../index-libraries/lib/index-library.str" link="${basedir}/lib/index-library.str" overwrite="true" />
			    <symlink resource="${basedir}/../index-libraries/lib/analysis-library.str" link="${basedir}/lib/analysis-library.str" overwrite="true" />
			  	<symlink resource="${basedir}/../index-libraries/lib/analysis-library-internal.str" link="${basedir}/lib/analysis-library-internal.str" overwrite="true" />
			    <symlink resource="${basedir}/../index-libraries/lib/compilation-library.str" link="${basedir}/lib/compilation-library.str" overwrite="true" />
			  	<symlink resource="${basedir}/../index-libraries/lib/nbl-library.str" link="${basedir}/lib/nbl-library.str" overwrite="true" />
			  </target>
    </project>