module refactor

imports
  include/Calculang
  calculang

rules
 
  rename-var:
    (newname, selected-name, position, ast, path, project-path) -> ([(ast, new-ast)], fatal-errors, errors, warnings)
    with
      new-ast  := <topdown(try(rename-type(|selected-name, newname)))> ast; 
      (errors, warnings) := <semantic-constraint-issues> (ast, new-ast);
      fatal-errors := []

  rename-type(|old-name, new-name):
    Assign(old-name, y) -> Assign(new-name, y)

  rename-type(|old-name, new-name):
    Var(old-name) -> Var(new-name)
    
  semantic-constraint-issues:
    (ast, new-ast) -> (<diff>(new-errors, errors), <diff>(new-warnings, warnings))
    where
      (_, errors, warnings, _) := <editor-analyze> (ast, "", "");
      (_, new-errors, new-warnings, _) := <editor-analyze> (new-ast, "", "")
